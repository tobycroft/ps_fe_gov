import{r as S,u as b,o as V,a as O,l as x,b as v,c as G,d as c,e as E,f as g,g as o,t as u,h as a,w as _,n as j,i as C,j as k,E as K}from"./index.28014d4a.js";import{r as D,u as d}from"./school.668a628c.js";import{u as H}from"./user.28bd1475.js";import{u as B}from"./area.70bfe4ed.js";import{g as X}from"./ak.7f196e16.js";const J="/images/login-zh-icon.png",Q="/images/login-code-icon.png",$=async r=>await D.post("https://api.ps.familyeducation.org.cn/v1/user/auth/phone",r),Y=async r=>await D.post("https://api.ps.familyeducation.org.cn/v1/user/auth/send",r),z=async r=>await D.post("https://api.ps.familyeducation.org.cn/v1/area/admin/me",r),P=S(60),R=S(!1),q=async r=>{await Y({phone:r})},Z=async r=>{await q(r),R.value=!0;const m=setInterval(()=>{P.value--,P.value<=0&&(R.value=!1,P.value=0,clearTimeout(m))},1e3)};const ee={class:"container-wrap flex"},oe={class:"logo_name_wrap"},ne={class:"title-char"},se=o("h1",{class:"title-char"},"\u4E00\u7AD9\u5F0F\u670D\u52A1\u6570\u667A\u5316\u5E73\u53F0",-1),ie={class:"flex-center login-container-wrap"},re={class:"login-wrap"},ae=["src"],me=o("h1",null,"\u767B\u5F55\u7BA1\u7406\u4E2D\u5FC3",-1),de={class:"flex item-wrap p"},te=o("div",{class:"icon-wrap flex-center"},[o("img",{class:"login-icon",src:J,alt:""})],-1),_e={class:"flex item-wrap"},le={class:"flex el-input-wrap"},pe=o("div",{class:"icon-wrap flex-center"},[o("img",{class:"login-icon",src:Q,alt:""})],-1),ce={key:0,class:"send-code grey"},Ce=k("\u767B\u5F55"),Re={__name:"loginView",setup(r){const m=b();console.log("query",m.query);const l=S({});V(async()=>{m.query.domain?await d().reqSchoolDomainGetAPI(m.query.domain):m.query.id&&await d().saveSchoolInfo(m.query.id),d().schoolDomainInfo.id?l.value=d().schoolDomainInfo:d().schoolInfo.id&&(l.value=d().schoolInfo)});const I=S({}),U=(i,e,n)=>{e===""?n(new Error("\u8BF7\u8F93\u5165\u624B\u673A\u53F7")):/^1((3[0-9])|(4[1579])|(5[0-9])|(6[6])|(7[0-9])|(8[0-9])|(9[0-9]))\d{8}$/.test(e)?n():n(new Error("\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E"))},F=(i,e,n)=>{e===""?n(new Error("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801")):n()},s=O({codeRef:"",phoneRef:""}),A=x();v(()=>{A.loginInfo.phone&&(s.phoneRef=A.loginInfo.phone)});const f=O({phoneRef:[{validator:U,trigger:"blur"}],codeRef:[{validator:F,trigger:"blur"}]}),M=i=>{!i||i.validate(e=>{if(e)console.log("submit!",s),L();else return console.log("error submit!"),!1})},L=async()=>{const i={phone:s.phoneRef,code:s.codeRef},e=await $(i);A.getLoginInfo(e.token,e.uid,s.phoneRef),await w()},h=G(),w=async()=>{const e=await z({});!e||e.length<1?K.error("\u65E0\u6743\u9650"):(y(e),h.push({path:"/studyReportForm"}))},y=i=>{const e=H(),n=d();n.saveSchoolInfoList();const t=i[0].school_id||6;B().saveAreaInfo(i[0]),n.saveSchoolInfo(t),e.saveSchoolUserInfo()};return(i,e)=>{const n=c("el-input"),t=c("el-form-item"),T=c("el-checkbox"),N=c("el-button"),W=c("el-form");return E(),g("div",{class:"root",style:j(`background-image: url(${l.value.bg_img||C(X)("login_bg.png")})`)},[o("div",ee,[o("div",oe,[o("h1",ne,u(l.value.name||"\u5B66\u6821\u5BB6\u5EAD\u6559\u80B2"),1),se]),o("div",ie,[o("div",re,[o("img",{class:"logo-po",src:l.value.icon||"/images/school_logo.png",alt:""},null,8,ae),me,a(W,{ref_key:"ruleFormRef",ref:I,model:s,"status-icon":"",rules:f,"label-width":"120px",class:"demo-ruleForm","label-position":"top",style:{width:"314px"}},{default:_(()=>[a(t,{"label-width":0,prop:"phoneRef",style:{width:"314px"}},{default:_(()=>[o("div",de,[te,a(n,{modelValue:s.phoneRef,"onUpdate:modelValue":e[0]||(e[0]=p=>s.phoneRef=p),type:"text",maxlength:11,resize:"none",clearable:"",autocomplete:"off",class:"el-input"},null,8,["modelValue"])])]),_:1}),a(t,{"label-width":0,prop:"codeRef",style:{width:"314px"}},{default:_(()=>[o("div",_e,[o("div",le,[pe,a(n,{resize:"none",class:"el-input code",maxlength:"6",modelValue:s.codeRef,"onUpdate:modelValue":e[1]||(e[1]=p=>s.codeRef=p),type:"codeRefword"},null,8,["modelValue"])]),C(R)?(E(),g("div",ce," \u5DF2\u53D1\u9001("+u(C(P))+"s) ",1)):(E(),g("div",{key:1,class:"send-code",onClick:e[2]||(e[2]=p=>C(Z)(s.phoneRef))}," \u83B7\u53D6\u9A8C\u8BC1\u7801 "))])]),_:1}),a(t,null,{default:_(()=>[a(T,{label:"\u8BB0\u4F4F\u8D26\u53F7",name:"type"})]),_:1}),a(t,null,{default:_(()=>[a(N,{class:"login-btn",type:"primary",onClick:e[3]||(e[3]=p=>M(I.value))},{default:_(()=>[Ce]),_:1})]),_:1})]),_:1},8,["model","rules"])])])])],4)}}};export{Re as default};
